version: '3.8'

services:
   # --- 1. SSL Proxy (Caddy) ---
  caddy:
    image: caddy:latest
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
      - caddy_data:/data
      - caddy_config:/config
    environment:
      - DOMAIN_NAME=${DOMAIN_NAME}
  # FastAPI Application
  raahi-assistant:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: raahi-assistant
    ports:
      - "8000:8000"
    environment:
      # Google Cloud
      - GCP_PROJECT_ID=cabswale-ai
      - GCP_LOCATION=asia-south1

      # Vertex AI / Gemini
      - GEMINI_MODEL=gemini-2.5-flash

      # TTS - Chirp 3 HD (Aoede voice)
      - TTS_VOICE_NAME=hi-IN-Chirp3-HD-Aoede
      - TTS_LANGUAGE_CODE=hi-IN

      # Firebase
      - FIREBASE_CREDENTIALS_PATH=/app/partnersdb-service-account.json
      - ENABLE_ANALYTICS_LOGGING=true

      # API
      - API_HOST=0.0.0.0
      - API_PORT=8000
    volumes:
      # Mount Google Cloud credentials if using service account
      - ${GOOGLE_APPLICATION_CREDENTIALS:-./credentials.json}:/app/credentials.json:ro
      # Mount Firebase credentials
      - ${FIREBASE_CREDENTIALS:-./partnersdb-service-account.json}:/app/partnersdb-service-account.json:ro
    env_file:
      - .env
    restart: unless-stopped
volumes:
  caddy_data:
  caddy_config:
